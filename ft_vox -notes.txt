/*
 * File Created: Sunday, 24th August 2025 10:49:39 pm
 * Author: Emily (Em-iIy) Winnink (emily.winnink@gmail.com)
 */

chunk:

states {
	unloaded,
	loaded,
	generated,
	meshed,
	drawable,
	dirty
}

update chunks {
	load: load from file the chunk block data {
		loop through load list until threshold {
			if chunk not loaded {
				load chunk
				set visibility update flag
			}
		}
		clear load list
	}

	setup: generate block data/set active blocks {
		loop through setup list until threshold {
			if chunk is loaded and not setup {
				setup chunk
				set visibility update flag
			}
		}
		clear setup list
	}

	rebuild: create/update mesh {
		loop through rebuild list until threshold {
			if chunk is loaded and setup {
				for neighboring chunks {
					set rebuild flag
					set visibility update flag
				}
				build chunk
			}
		}
		clear rebuild list
	}

	update flags: probably not needed

	unload: free/write to file chunk block data {
		loop through unload list {
			if chunk is loaded and not built {
				build chunk
				set visibility update flag
			}
		}
		clear rebuild list
	}

	visible: updates whether chunks should be loaded/rebuilt/unloaded/rendered (visible) {
		if visibility update flag is set {
			loop through all chunks? {
				if chunk in of render distance {
					if chunk is null {
						push to load list
					}
					else if chunk is loaded {
						if chunk is not set up {
							push to setup list
						}
						else if chunk should rebuild {
							push to rebuild list
						}
						else {
							push to visible list
						}
					}
				}
				else if chunk is outside render distance {
					push to unload list
				}
			}
		}
	}

	render: check if chunk should be rendered {
		clear render list
		loop through {
			check if chunk is loaded and built {
				? check frustum culling {
					add to render list
				}
			}
		}
	}
}

render {
	loop through render list {
		draw chunks
	}
}

render order {
	render shadow map {
		bind shadowBuffer
		clear shadowBuffer depth texture
		render chunks {
			depth -> depth texture
		}
	}
	render terrain {
		bind gBuffer
		clear gBuffer {
			clear color attachment 0
			clear color attachment 1
			clear depth buffer
		}
		render chunks {
			color -> color attachment 0
			normals -> color attachment 1
		}
	}
	render water {
		bind waterBuffer
		clear waterBuffer {
			clear color attachment 0
			clear depth buffer
		}
		blit (copy) depth buffer from gBuffer
		bind waterBuffer
		render water {
			color -> color attachment 0
			depth -> depth buffer
		}
	}
	SSAO pass {
		bind gBuffer

	}
	render gBuffer final {
		bind main buffer
		render gBuffer -> main buffer
	}
	render water final {
		bind main buffer
		render water -> main buffer
	}
}

back
0 2 1, 1 2 3

2 3
0 1

front
4 5 6, 5 7 6

6 7
4 5

left
0 4 6, 0 6 2

2 6
0 4

right
1 7 5, 1 3 7

7 3
5 1

top
2 6 7, 2 7 3

2 3
6 7

bottom
1 4 0, 1 5 4

4 5
0 1